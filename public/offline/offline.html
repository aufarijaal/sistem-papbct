<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Style -->
    <link rel="stylesheet" href="../css/app.css">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <style>
        .dashboard {
            display: grid;
            height: 100%;
            width: 100%;
            grid-template-columns: 1fr;
            grid-template-rows: auto 66px;
        }
        #main-content {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 65px auto;
        }
        aside {
            height: 66px;
        }
        .slide-out-top {
            -webkit-animation: slide-out-top 0.5s cubic-bezier(0.600, -0.280, 0.735, 0.045) both;
            animation: slide-out-top 0.5s cubic-bezier(0.600, -0.280, 0.735, 0.045) both;
        }
        @-webkit-keyframes slide-out-top {
            0% {
                -webkit-transform: translateY(0);
                        transform: translateY(0);
                -webkit-transform: translateX(-50%);
                transform: translateX(-50%);
                opacity: 1;
            }
            100% {
                -webkit-transform: translateY(-1000px);
                        transform: translateY(-1000px);
                opacity: 0;
            }
        }
        @keyframes slide-out-top {
            0% {
                -webkit-transform: translateY(0);
                        transform: translateY(0);
                -webkit-transform: translateX(-50%);
                        transform: translateX(-50%);
                opacity: 1;
            }
            100% {
                -webkit-transform: translateY(-1000px);
                        transform: translateY(-1000px);
                opacity: 0;
            }
        }
        /* sm */
        @media (min-width: 640px) {

        }
        /* md */
        @media (min-width: 768px) {

        }
        /* lg */
        @media (min-width: 1024px) {
        .dashboard {
            grid-template-columns: 80px auto;
            grid-template-rows: 1fr;
        }
        aside {
            order: -1;
        }
        }
        /* xl */
        @media (min-width: 1280px) {

        }
        /* 2xl */
        @media (min-width: 1536px) {

        }
    </style>
    <title>Offline</title>
</head>
<body>
    <div id="alert" class=" bg-red-100 border-red-200 text-red-500 border-2 box-content shadow-lg w-52 h-auto flex justify-center items-center p-2 fixed top-5 left-1/2 -translate-x-1/2 z-50">
        <span class="text-xs font-semibold" id="message">Anda sedang offline, silahkan reload jika kembali online</span>
    </div>


    <div id="app">
        <div class="dashboard">
            <main>
                <div class="w-full h-full">
                    <div id="main-content" class="text-2xl flex items-center text-center text-zinc-900 tracking-wide lg:text-left lg:pl-10">
                        <h1 style="font-weight: 780; font-variation-settings: 'wght' 780">Offline</h1>
                        <p class="text-xs">ID mesin : <span id="machine-id-value"></span></p>
                      </div>
                      <div class="h-full lg:h-auto">
                        <div class="stats flex flex-col justify-center items-center gap-4 py-5">
                            <div id="chart-wrapper" class="w-11/12 md:w-2/3">
                                <canvas id="stat-chart" class="bg-white rounded-lg border-2 border-zinc-200 lg:p-2"></canvas>
                            </div>
                            <div class="filter-date-wrapper">
                                <select onchange="update()" class="w-28 h-10 rounded-full appearance-none pl-3 bg-teal-100 text-teal-500 cursor-pointer outline-none border-0" name="filter-date" id="filter-date">
                                    <option value="hari">Hari ini</option>
                                    <option value="pekan">7 Hari</option>
                                    <option value="bulan">Bulan ini</option>
                                </select>
                            </div>
                        </div>
                      </div>
                </div>
            </main>
            <aside class="bg-zinc-900 lg:static fixed bottom-0 lg:bottom-auto w-full lg:h-auto">
                <ul class="flex flex-row justify-between items-center h-full w-full lg:flex-col">
                  <li class="w-full h-full hidden lg:flex justify-center items-center">
                    <img class="scale-75" src="../icons/icon-72x72.png">
                  </li>
                  <li class="w-full h-full" title="Dashboard">
                    <a href="#" class="flex justify-center items-center w-full h-full group">
                        <div class="icon p-2 rounded-md">
                            <svg width="36" height="36" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="transition fill-black"><path d="M10.55 2.532a2.25 2.25 0 0 1 2.9 0l6.75 5.692c.507.428.8 1.057.8 1.72v9.803a1.75 1.75 0 0 1-1.75 1.75h-3.5a1.75 1.75 0 0 1-1.75-1.75v-5.5a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25v5.5a1.75 1.75 0 0 1-1.75 1.75h-3.5A1.75 1.75 0 0 1 3 19.747V9.944c0-.663.293-1.292.8-1.72l6.75-5.692Zm1.933 1.147a.75.75 0 0 0-.966 0L4.767 9.37a.75.75 0 0 0-.267.573v9.803c0 .138.112.25.25.25h3.5a.25.25 0 0 0 .25-.25v-5.5c0-.967.784-1.75 1.75-1.75h3.5c.966 0 1.75.783 1.75 1.75v5.5c0 .138.112.25.25.25h3.5a.25.25 0 0 0 .25-.25V9.944a.75.75 0 0 0-.267-.573l-6.75-5.692Z" fill="#6b7280"/></svg>
                        </div>
                    </a>
                  </li>
                  <li class="w-full h-full" title="Statistik">
                    <a href="#" class="flex justify-center items-center w-full h-full group">
                    <div class="icon p-2 rounded-md">
                          <svg width="36" height="36" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="transition"><path d="M18.25 2.997A2.75 2.75 0 0 1 21 5.747v12.5a2.75 2.75 0 0 1-2.75 2.75H5.75A2.75 2.75 0 0 1 3 18.247v-12.5a2.75 2.75 0 0 1 2.75-2.75h12.5ZM7.75 9a.748.748 0 0 0-.75.747v6.507c0 .412.336.746.75.746s.75-.334.75-.746V9.747A.748.748 0 0 0 7.75 9Zm8.5-2a.74.74 0 0 0-.75.73v8.541c0 .403.336.73.75.73a.74.74 0 0 0 .75-.73V7.73a.74.74 0 0 0-.75-.73Zm-4.275 4.997a.73.73 0 0 0-.725.734l.035 3.547a.73.73 0 0 0 .74.72.73.73 0 0 0 .725-.734l-.035-3.548a.73.73 0 0 0-.74-.719Z" fill="#fff"/></svg>
                    </div>
                    </a>
                  </li>
                  <li class="w-full h-full hidden lg:block" title="Pengaturan">
                    <a href="#" class="flex justify-center items-center w-full h-full group">
                    <div class="icon p-2 rounded-md">
                        <svg width="36" height="36" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="transition fill-black"><path d="M12.012 2.25c.734.008 1.465.093 2.182.253a.75.75 0 0 1 .582.649l.17 1.527a1.384 1.384 0 0 0 1.927 1.116l1.401-.615a.75.75 0 0 1 .85.174 9.792 9.792 0 0 1 2.204 3.792.75.75 0 0 1-.271.825l-1.242.916a1.381 1.381 0 0 0 0 2.226l1.243.915a.75.75 0 0 1 .272.826 9.797 9.797 0 0 1-2.204 3.792.75.75 0 0 1-.848.175l-1.407-.617a1.38 1.38 0 0 0-1.926 1.114l-.169 1.526a.75.75 0 0 1-.572.647 9.518 9.518 0 0 1-4.406 0 .75.75 0 0 1-.572-.647l-.168-1.524a1.382 1.382 0 0 0-1.926-1.11l-1.406.616a.75.75 0 0 1-.849-.175 9.798 9.798 0 0 1-2.204-3.796.75.75 0 0 1 .272-.826l1.243-.916a1.38 1.38 0 0 0 0-2.226l-1.243-.914a.75.75 0 0 1-.271-.826 9.793 9.793 0 0 1 2.204-3.792.75.75 0 0 1 .85-.174l1.4.615a1.387 1.387 0 0 0 1.93-1.118l.17-1.526a.75.75 0 0 1 .583-.65c.717-.159 1.45-.243 2.201-.252Zm0 1.5a9.135 9.135 0 0 0-1.354.117l-.109.977A2.886 2.886 0 0 1 6.525 7.17l-.898-.394a8.293 8.293 0 0 0-1.348 2.317l.798.587a2.881 2.881 0 0 1 0 4.643l-.799.588c.32.842.776 1.626 1.348 2.322l.905-.397a2.882 2.882 0 0 1 4.017 2.318l.11.984c.889.15 1.798.15 2.687 0l.11-.984a2.881 2.881 0 0 1 4.018-2.322l.905.396a8.296 8.296 0 0 0 1.347-2.318l-.798-.588a2.881 2.881 0 0 1 0-4.643l.796-.587a8.293 8.293 0 0 0-1.348-2.317l-.896.393a2.884 2.884 0 0 1-4.023-2.324l-.11-.976a8.988 8.988 0 0 0-1.333-.117ZM12 8.25a3.75 3.75 0 1 1 0 7.5 3.75 3.75 0 0 1 0-7.5Zm0 1.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z" fill="#6b7280"/></svg>
                    </div>
                    </a>
                  </li>
                  <li class="w-full h-full block lg:hidden">
                    <div class="flex justify-center items-center w-full h-full group">
                    <div class="icon p-2 rounded-md">
                          <svg width="36" height="36" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="transition fill-black"><path d="M17.754 14a2.249 2.249 0 0 1 2.25 2.249v.575c0 .894-.32 1.76-.902 2.438-1.57 1.834-3.957 2.739-7.102 2.739-3.146 0-5.532-.905-7.098-2.74a3.75 3.75 0 0 1-.898-2.435v-.577a2.249 2.249 0 0 1 2.249-2.25h11.501Zm0 1.5H6.253a.749.749 0 0 0-.75.749v.577c0 .536.192 1.054.54 1.461 1.253 1.468 3.219 2.214 5.957 2.214s4.706-.746 5.962-2.214a2.25 2.25 0 0 0 .541-1.463v-.575a.749.749 0 0 0-.749-.75ZM12 2.004a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z" fill="#6b7280"/></svg>
                    </div>
                    </div>
                  </li>
                  <li class="w-full h-full hidden lg:block" title="logout">
                      <form action="#" method="POST" class="w-full h-full">
                          <a href="#" class="flex justify-center items-center w-full h-full group" id="form-logout">
                            <div class="transition group icon p-2 rounded-md">
                                <svg width="36" height="36" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="transition fill-black"><path d="M8.502 11.5a1.002 1.002 0 1 1 0 2.004 1.002 1.002 0 0 1 0-2.004Z" fill="#6b7280"/><path d="M12 4.354v6.651l7.442-.001L17.72 9.28a.75.75 0 0 1-.073-.976l.073-.084a.75.75 0 0 1 .976-.073l.084.073 2.997 2.997a.75.75 0 0 1 .073.976l-.073.084-2.996 3.004a.75.75 0 0 1-1.134-.975l.072-.085 1.713-1.717-7.431.001L12 19.25a.75.75 0 0 1-.88.739l-8.5-1.502A.75.75 0 0 1 2 17.75V5.75a.75.75 0 0 1 .628-.74l8.5-1.396a.75.75 0 0 1 .872.74Zm-1.5.883-7 1.15V17.12l7 1.236V5.237Z" fill="#6b7280"/><path d="M13 18.501h.765l.102-.006a.75.75 0 0 0 .648-.745l-.007-4.25H13v5.001ZM13.002 10 13 8.725V5h.745a.75.75 0 0 1 .743.647l.007.102.007 4.251h-1.5Z" fill="#6b7280"/></svg>
                            </div>
                          </a>
                      </form>
                  </li>
                </ul>
              </aside>
        </div>
    </div>
    <script src="../js/chart.min.js"></script>
    <script>
        const filterDate = document.getElementById('filter-date')
        const id = document.getElementById('machine-id-value')
        const canvasWrapper = document.getElementById('chart-wrapper')
        const chartCanvas = document.getElementById('stat-chart').getContext('2d')


        let delayed
        let gradient = chartCanvas.createLinearGradient(0,0,0,450)
        gradient.addColorStop(0, 'rgba(253,230,138, 1)');
        gradient.addColorStop(0.5, 'rgba(253,230,138, 0.5)');
        gradient.addColorStop(1, 'rgba(253,230,138, 0.2)');

        let dummyData = {
            labels: ['08/05', '09/05', '10/05', '11/05', '12/05', '13/05', '14/05'],
            data: [2.1, 3.4, 5.3, 0.3, 2.7, 1.2, 3.3]
        }

        let datasets = {
            labels: dummyData.labels,
            datasets: [{
                backgroundColor: gradient,
                borderWidth: 3,
                hoverBorderWidth: 4,
                pointRadius: 4,
                pointHoverRadius: 8,
                tension: 0.1,
                hitRadius: 30,
                pointBackgroundColor: 'rgba(255, 255, 255, 1)',
                borderColor: '#fbbf24',
                fill: true,
                data: dummyData.data
            }]
        }

        let config = {
            type: 'line',
            data: datasets,
            options: {
                responsive: true,
                maintainAspectRatio: true,
                animation: {
                    onComplete: () => {
                        delayed = true;
                    },
                    delay: (context) => {
                        let delay = 0;
                        if (context.type === 'data' && context.mode === 'default' && !delayed) {
                        delay = context.dataIndex * 300 + context.datasetIndex * 100;
                        }
                        return delay;
                    },
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: '',
                        padding: {
                            bottom: 20,
                            top: 20
                        }
                    },
                    tooltip: {
                        padding: 10,
                        enabled: true,
                        backgroundColor: 'rgb(39,39,42)',
                        displayColors: false,
                        callbacks: {
                            title: (tooltipItem) => {
                                return 'Waktu Produksi : ' + tooltipItem[0].label
                            },
                            label: (tooltipItem) => {
                                return 'Berat : ' + tooltipItem.formattedValue + ' Kg'
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value, index, ticks) => {
                                return value + ' Kg'
                            }
                        }
                    }
                },
            },
        }

        let statChart = new Chart(chartCanvas, config)

        const update = async () => {
            try {
                let newData = await JSON.parse(localStorage.getItem(filterDate.value == 'hari' ? 'cache_hari' : filterDate.value == 'pekan' ? 'cache_pekan' : 'cache_bulan'))

                statChart['data']['labels'] = newData.labels
                statChart.data.datasets.forEach((dataset) => {
                    dataset['data'] = newData.data
                })
                statChart.options.plugins.title.text = newData.title
                statChart.options.plugins.tooltip.callbacks.title = (tooltipItem) => {
                    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember']
                    if(filterDate.value == 'pekan' || filterDate.value == 'bulan') {
                        return 'Waktu Produksi : ' + tooltipItem[0].label.split('/')[1] + ' ' + monthNames[parseInt(tooltipItem[0].label.split('/')[0] -1)]
                    } else {
                        return 'Waktu Produksi : Pukul ' + tooltipItem[0].label
                    }
                }
                statChart.update()
            }
            catch(err) {
                alert(error.stack)
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const alert = document.getElementById('alert')
            document.getElementById('machine-id-value').innerText += localStorage.getItem('machineid') || ''


            setTimeout(() => {
                alert.classList.add('slide-out-top')
            }, 3000);
            setTimeout(() => {
                alert.classList.remove('slide-out-top')
                alert.classList.replace('flex', 'hidden')
            }, 4000);
        })
    </script>
</body>
</html>
